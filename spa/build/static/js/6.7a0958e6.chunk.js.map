{"version":3,"sources":["pages/Login/Login.module.css","pages/Login/Login.js"],"names":["module","exports","Login","user","useContext","UserContext","client","ClientContext","cache","useQueryCache","login","isLoading","isLoadingLogin","useMutation","name","loginUser","onMutate","cancelQueries","userQuery","snapshot","getQueryData","setQueryData","onError","onSettled","invalidateQueries","logout","isLoadingLogout","logoutUser","onLogout","e","preventDefault","isPending","className","cs","content","form","onSubmit","data","FormData","target","get","required","autoFocus","disabled","type","placeholder","defaultValue","undefined","onClick","value"],"mappings":"oGACAA,EAAOC,QAAU,CAAC,QAAU,uBAAuB,KAAO,sB,iGCoF3CC,UA3ED,KACZ,IAAMC,EAAOC,qBAAWC,KAClBC,EAASF,qBAAWG,KACpBC,EAAQC,eACPC,GAASC,UAAWC,IAAoBC,aAC5CC,GAASR,EAAOS,UAAUD,IAC3B,CACEE,SAAWF,IACTN,EAAMS,cAAcC,KACpB,IAAMC,EAAWX,EAAMY,aAAaF,KAEpC,OADAV,EAAMa,aAAaH,IAAWJ,GACvB,IAAMN,EAAMa,aAAaH,IAAWC,IAE7CG,YACAC,UAAW,KACTf,EAAMgB,kBAAkBN,SASvBO,GAAUd,UAAWe,IAAqBb,aAC/C,IAAMP,EAAOqB,cACb,CACEX,SAAU,KACRR,EAAMS,cAAcC,KACpB,IAAMC,EAAWX,EAAMY,aAAaF,KAEpC,OADAV,EAAMa,aAAaH,IAAW,MACvB,IAAMV,EAAMa,aAAaH,IAAWC,IAE7CG,YACAC,UAAW,KACTf,EAAMgB,kBAAkBN,QAIxBU,EAAQ,8BAAG,UAAOC,GACtBA,EAAEC,iBACFL,OAFY,sDAIRM,EAAYnB,GAAkBc,EACpC,OACE,0BAASM,UAAWC,IAAGC,QAAvB,UACE,6BAAK/B,EAAO,4CAAOA,KAAW,2DAC9B,uBAAM6B,UAAWC,IAAGE,KAAMC,SA5BbP,IACfA,EAAEC,iBACF,IAAMO,EAAO,IAAIC,SAAST,EAAEU,QAC5B7B,EAAM2B,EAAKG,IAAI,cAyBb,UACE,uBACEC,UAAQ,EACRC,WAAS,EACTC,SAAUZ,EACVa,KAAK,OACLC,YAAY,WACZC,aAAc3C,QAAQ4C,EACtBjC,KAAK,aAENX,EACC,uBACEwC,SAAUZ,EACViB,QAASpB,EACTgB,KAAK,SACLK,MAAM,WAEN,KACJ,uBACEN,SAAUZ,EACVa,KAAK,SACLK,MAAO9C,EAAO,SAAW","file":"static/js/6.7a0958e6.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"Login_content__2phGC\",\"form\":\"Login_form__2HM6Y\"};","import { useContext } from \"react\";\r\nimport {\r\n  ClientContext,\r\n  UserContext,\r\n  userQuery,\r\n  onError,\r\n} from \"../../constants\";\r\nimport cs from \"./Login.module.css\";\r\nimport { useMutation, useQueryCache } from \"react-query\";\r\n\r\nconst Login = () => {\r\n  const user = useContext(UserContext);\r\n  const client = useContext(ClientContext);\r\n  const cache = useQueryCache();\r\n  const [login, { isLoading: isLoadingLogin }] = useMutation(\r\n    (name) => client.loginUser(name),\r\n    {\r\n      onMutate: (name) => {\r\n        cache.cancelQueries(userQuery);\r\n        const snapshot = cache.getQueryData(userQuery);\r\n        cache.setQueryData(userQuery, name);\r\n        return () => cache.setQueryData(userQuery, snapshot);\r\n      },\r\n      onError,\r\n      onSettled: () => {\r\n        cache.invalidateQueries(userQuery);\r\n      },\r\n    }\r\n  );\r\n  const onLogin = (e) => {\r\n    e.preventDefault();\r\n    const data = new FormData(e.target);\r\n    login(data.get(\"username\"));\r\n  };\r\n  const [logout, { isLoading: isLoadingLogout }] = useMutation(\r\n    () => client.logoutUser(),\r\n    {\r\n      onMutate: () => {\r\n        cache.cancelQueries(userQuery);\r\n        const snapshot = cache.getQueryData(userQuery);\r\n        cache.setQueryData(userQuery, null);\r\n        return () => cache.setQueryData(userQuery, snapshot);\r\n      },\r\n      onError,\r\n      onSettled: () => {\r\n        cache.invalidateQueries(userQuery);\r\n      },\r\n    }\r\n  );\r\n  const onLogout = async (e) => {\r\n    e.preventDefault();\r\n    logout();\r\n  };\r\n  const isPending = isLoadingLogin || isLoadingLogout;\r\n  return (\r\n    <section className={cs.content}>\r\n      <h1>{user ? <>Hi, {user}</> : <>What's your name?</>}</h1>\r\n      <form className={cs.form} onSubmit={onLogin}>\r\n        <input\r\n          required\r\n          autoFocus\r\n          disabled={isPending}\r\n          type=\"text\"\r\n          placeholder=\"username\"\r\n          defaultValue={user || undefined}\r\n          name=\"username\"\r\n        />\r\n        {user ? (\r\n          <input\r\n            disabled={isPending}\r\n            onClick={onLogout}\r\n            type=\"button\"\r\n            value=\"logout\"\r\n          />\r\n        ) : null}\r\n        <input\r\n          disabled={isPending}\r\n          type=\"submit\"\r\n          value={user ? \"change\" : \"login\"}\r\n        />\r\n      </form>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"],"sourceRoot":""}