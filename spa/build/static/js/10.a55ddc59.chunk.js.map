{"version":3,"sources":["pages/SendToMars/SendToMars.module.css","pages/SendToMars/SendToMars.js"],"names":["module","exports","SendToMars","client","useContext","ClientContext","data","items","useQuery","sentToMarsQuery","getSentToMars","cache","useQueryCache","send","isLoadingSend","useMutation","item","sendToMars","onMutate","cancelQueries","snapshot","getQueryData","setQueryData","prev","id","Math","random","onError","onSettled","invalidateQueries","cancel","isLoading","isLoadingCancel","cancelSendingToMars","filter","x","isPending","className","cs","content","onSubmit","e","preventDefault","FormData","target","keys","Object","fromEntries","map","key","get","pick","disabled","form","required","type","name","defaultValue","value","length","console","log","style","color","important","onClick"],"mappings":"qGACAA,EAAOC,QAAU,CAAC,QAAU,4BAA4B,MAAQ,0BAA0B,KAAO,2B,iGCgHlFC,UAtGI,KACjB,IAAMC,EAASC,qBAAWC,MAClBC,KAAMC,GAAUC,YAASC,KAAiB,IAChDN,EAAOO,kBAEHC,EAAQC,eACPC,GAAM,cAAEC,IAAmBC,aAC/BC,GAASb,EAAOc,WAAWD,IAC5B,CACEE,SAAWF,IACTL,EAAMQ,cAAcV,KACpB,IAAMW,EAAWT,EAAMU,aAAaZ,KAKpC,OAJAE,EAAMW,aAAab,KAAkBc,GAAS,IACzCA,EADyC,2BAEvCP,GAFuC,IAEjCQ,GAAIC,KAAKC,cAEf,IAAMf,EAAMW,aAAab,IAAiBW,IAEnDO,YACAC,UAAW,KACTjB,EAAMkB,kBAAkBpB,SASvBqB,GAAUC,UAAWC,IAAqBjB,aAC9CC,GAASb,EAAO8B,oBAAoBjB,IACrC,CACEE,SAAWF,IACTL,EAAMQ,cAAcV,KACpB,IAAMW,EAAWT,EAAMU,aAAaZ,KAIpC,OAHAE,EAAMW,aAAab,KAAkBc,GACnCA,EAAKW,QAAQC,GAAMA,EAAEX,KAAOR,EAAKQ,OAE5B,IAAMb,EAAMW,aAAab,IAAiBW,IAEnDO,YACAC,UAAW,KACTjB,EAAMkB,kBAAkBpB,QAIxB2B,EAAYtB,GAAiBkB,EACnC,OACE,0BAASK,UAAWC,IAAGC,QAAvB,UACE,8CACA,kCACE,sBAAMC,SA3BMC,IAChBA,EAAEC,iBACF,IAAMpC,EAAO,IAAIqC,SAASF,EAAEG,QAC5B/B,EAjCS,EAACP,EAAMuC,IACTC,OAAOC,YAAYF,EAAKG,KAAKC,GAAQ,CAACA,EAAK3C,EAAK4C,IAAID,OAgCtDE,CAAK7C,EAAM,CAAC,OAAQ,QAAS,SAAU,QAAS,gBAwBjD,SACE,2BAAU8C,SAAUhB,EAAWC,UAAWC,IAAGe,KAA7C,UACE,0CACO,uBAAOC,UAAQ,EAACC,KAAK,OAAOC,KAAK,YAExC,2CACQ,uBAAOF,UAAQ,EAACC,KAAK,MAAMC,KAAK,aAExC,4CACS,uBAAOD,KAAK,SAASC,KAAK,cAEnC,2CACQ,uBAAOD,KAAK,QAAQC,KAAK,QAAQC,aAAa,eAEtD,+CACY,uBAAOF,KAAK,WAAWC,KAAK,iBAExC,2CACQ,uBAAOD,KAAK,SAASG,MAAM,mBAKzC,kCACGnD,EAAMoD,OAAS,EACd,qCACE,yDACA,oBAAItB,UAAWC,IAAG/B,MAAlB,SACGA,EAAMyC,KAAKhC,IAIV4C,QAAQC,IAAI7C,GAEV,qBAAkB8C,MAAO,CAAEC,MAAO/C,EAAK+C,OAAvC,UACG/C,EAAKwC,KACLxC,EAAKgD,UAAY,QAAU,IAC5B,wBAAQC,QARI,KACdnC,EAAOd,IAOL,iBAHOA,EAAKQ,YAUtB","file":"static/js/10.a55ddc59.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"content\":\"SendToMars_content__3EiVA\",\"items\":\"SendToMars_items__nU2qh\",\"form\":\"SendToMars_form__1NIOr\"};","import React, { useContext } from \"react\";\r\nimport { useMutation, useQuery, useQueryCache } from \"react-query\";\r\nimport { ClientContext, onError, sentToMarsQuery } from \"../../constants\";\r\nimport cs from \"./SendToMars.module.css\";\r\n\r\nconst pick = (data, keys) => {\r\n   let x = Object.fromEntries(keys.map((key) => [key, data.get(key)]));\r\n   return x;\r\n}\r\n\r\n\r\nconst SendToMars = () => {\r\n  const client = useContext(ClientContext);\r\n  const { data: items } = useQuery(sentToMarsQuery, () =>\r\n    client.getSentToMars()\r\n  );\r\n  const cache = useQueryCache();\r\n  const [send, { isLoadingSend }] = useMutation(\r\n    (item) => client.sendToMars(item),\r\n    {\r\n      onMutate: (item) => {\r\n        cache.cancelQueries(sentToMarsQuery);\r\n        const snapshot = cache.getQueryData(sentToMarsQuery);\r\n        cache.setQueryData(sentToMarsQuery, (prev) => [\r\n          ...prev,\r\n          { ...item, id: Math.random() },\r\n        ]);\r\n        return () => cache.setQueryData(sentToMarsQuery, snapshot);\r\n      },\r\n      onError,\r\n      onSettled: () => {\r\n        cache.invalidateQueries(sentToMarsQuery);\r\n      },\r\n    }\r\n  );\r\n  const onSubmit = (e) => {\r\n    e.preventDefault();\r\n    const data = new FormData(e.target);\r\n    send(pick(data, [\"name\", \"phone\", \"weight\", \"color\", \"important\"]));\r\n  };\r\n  const [cancel, { isLoading: isLoadingCancel }] = useMutation(\r\n    (item) => client.cancelSendingToMars(item),\r\n    {\r\n      onMutate: (item) => {\r\n        cache.cancelQueries(sentToMarsQuery);\r\n        const snapshot = cache.getQueryData(sentToMarsQuery);\r\n        cache.setQueryData(sentToMarsQuery, (prev) =>\r\n          prev.filter((x) => x.id !== item.id)\r\n        );\r\n        return () => cache.setQueryData(sentToMarsQuery, snapshot);\r\n      },\r\n      onError,\r\n      onSettled: () => {\r\n        cache.invalidateQueries(sentToMarsQuery);\r\n      },\r\n    }\r\n  );\r\n  const isPending = isLoadingSend || isLoadingCancel;\r\n  return (\r\n    <section className={cs.content}>\r\n      <h1>Send to Mars</h1>\r\n      <section>\r\n        <form onSubmit={onSubmit}>\r\n          <fieldset disabled={isPending} className={cs.form}>\r\n            <label>\r\n              Name <input required type=\"text\" name=\"name\" />\r\n            </label>\r\n            <label>\r\n              Phone <input required type=\"tel\" name=\"phone\" />\r\n            </label>\r\n            <label>\r\n              Weight <input type=\"number\" name=\"weight\" />\r\n            </label>\r\n            <label>\r\n              Color <input type=\"color\" name=\"color\" defaultValue=\"#ffffff\" />\r\n            </label>\r\n            <label>\r\n              Important <input type=\"checkbox\" name=\"important\" />\r\n            </label>\r\n            <label>\r\n              Done? <input type=\"submit\" value=\"send\" />\r\n            </label>\r\n          </fieldset>\r\n        </form>\r\n      </section>\r\n      <section>\r\n        {items.length > 0 ? (\r\n          <>\r\n            <h2>Waiting for launch date</h2>\r\n            <ul className={cs.items}>\r\n              {items.map((item) => {\r\n                const onClick = () => {\r\n                  cancel(item);\r\n                };\r\n                console.log(item);\r\n                return (\r\n                  <li key={item.id} style={{ color: item.color }}>\r\n                    {item.name}\r\n                    {item.important ? \" (!) \" : \" \"}\r\n                    <button onClick={onClick}>X</button>\r\n                  </li>\r\n                );\r\n              })}\r\n            </ul>\r\n          </>\r\n        ) : (\r\n          <h2>Queue is empty</h2>\r\n        )}\r\n      </section>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default SendToMars;\r\n"],"sourceRoot":""}